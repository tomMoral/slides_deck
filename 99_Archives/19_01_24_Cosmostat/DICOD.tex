\documentclass[main_tikz.tex]{subfiles}
%\usetikzlibrary{...}


%\usepackage{beamerarticle}
\begin{document}

\begin{tikzpicture}


\pgfmathsetmacro{\iO}{6}
\pgfmathsetmacro{\ig}{12}
\pgfmathsetmacro{\igg}{16}
\pgfmathsetmacro{\jO}{3}
\pgfmathsetmacro{\width}{30}
\pgfmathsetmacro{\height}{2}
\pgfmathsetmacro{\wspace}{1}
\pgfmathsetmacro{\K}{5}
\pgfmathsetmacro{\L}{9}
\pgfmathsetmacro{\W}{2}
\pgfmathtruncatemacro{\k}{\K-1}
\pgfmathtruncatemacro{\w}{\L-1}
\pgfmathtruncatemacro{\ww}{\L-2}
\pgfmathsetmacro{\Lm}{30}

\node[] (Cm) {};


\visible<2>{
    \fill[green!20] ($ (Cm.center) + (\iO*\width /\Lm/2 - \w/2*\width /\Lm/2, 0)$)
    -- ++(0, -\height)
    -- ++(\L*\width/2/\Lm, 0)
    -- ++(0, \height)
    -- cycle;
    \draw[<->, dashed] ($ (Cm.center) + (\iO*\width /\Lm/2 - \w/2*\width /\Lm/2, -\height/2.1)$)
    -- ++(\L*\width/2/\Lm, 0) node[midway, below, above, thick] {\hskip.5em$2L-1$ };
    \fill[blue!50] ($ (Cm.center) + (\iO*\width /\Lm/2, -\jO*\height /\K)$)
    -- ++(0, -\height/\K)
    -- ++(\width/2/\Lm, 0)
    -- ++(0, \height/\K)
    -- cycle;
}
\only<3->{
    \fill[red!20] ($ (Cm.center) + (\ig*\width /\Lm/2 - \w/2*\width /\Lm/2, 0)$)
    -- ++(0, -\height)
    -- ++(\L*\width/2/\Lm, 0)
    -- ++(0, \height)
    -- cycle;
    
    \fill[blue!50] ($ (Cm.center) + (\ig*\width /\Lm/2, -\jO*\height /\K)$)
    -- ++(0, -\height/\K)
    -- ++(\width/2/\Lm, 0)
    -- ++(0, \height/\K)
    -- cycle;
    
}

\only<4>{
    
    \fill[red!20] ($ (Cm.center) + (\igg*\width /\Lm/2 - \w/2*\width /\Lm/2, 0)$)
    -- ++(0, -\height)
    -- ++(\L*\width/2/\Lm, 0)
    -- ++(0, \height)
    -- cycle;
    \fill[gray!40] ($ (Cm.center) + (\igg*\width /\Lm/2 - \w/2*\width /\Lm/2, 0)$)
    -- ++(0, -\height)
    -- ++(\w/2*\width /\Lm/2, 0)
    -- ++(\width /\Lm/2, 0)
    -- ++(0, \height)
    -- cycle;
    \fill[blue!50] ($ (Cm.center) + (\igg*\width /\Lm/2, -\jO*\height /\K)$)
    -- ++(0, -\height/\K)
    -- ++(\width/2/\Lm, 0)
    -- ++(0, \height/\K)
    -- cycle;
    \fill[blue!50] ($ (Cm.center) + (\ig*\width /\Lm/2, -\jO*\height /\K)$)
    -- ++(0, -\height/\K)
    -- ++(\width/2/\Lm, 0)
    -- ++(0, \height/\K)
    -- cycle;
}

\draw (Cm.center)
-- ++(\width/2, 0)
-- ++(0, -\height)
-- ++(-\width/2, 0) node[midway, below] {coordinates of $Z$}
-- cycle;

\foreach \i in {1,...,\k}{
    \draw ($ (Cm.center) - (0, \i*\height /\K)$)
    -- ++(\width/2, 0);
}
\foreach \i in {1,...,\Lm}{
    \draw ($ (Cm.center) + (\i*\width/2/\Lm, 0)$)
    -- ++(0, -\height);
}

% Draw the worker boundaries
\draw [ultra thick] (Cm.center) 
-- ++(0, -\height);
\foreach \i in {1,...,\W}{
    \draw [ultra thick] ($ (Cm.center) + (\i*\width/2/\W, 0)$)
    -- ++(0, -\height);
    \draw [ultra thick] ($ (Cm.center) + (\i*\width/2/\W, 0)$)
    -- ++(-\width/2/\W, 0) node[midway, above] {$\mathcal S_{\i}$};
    \draw [ultra thick] ($ (Cm.center) + (\i*\width/2/\W, -\height)$)
    -- ++(-\width/2/\W, 0);
}

\only<3>{

\draw[->, thick] ($ (Cm.center) + (\ig*\width /\Lm/2, -\jO*\height /\K) + (\width/\Lm/4, -\height /\K/2)$) arc (135:45:1.5) node [midway, above, fill=blue!10] {$(k, t, \Delta Z)$};
}
\end{tikzpicture}


\end{document}
