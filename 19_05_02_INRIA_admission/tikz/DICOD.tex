\documentclass[main_tikz.tex]{subfiles}
%\usetikzlibrary{...}


%\usepackage{beamerarticle}
\begin{document}

\begin{tikzpicture}


\pgfmathsetmacro{\iO}{6}
\pgfmathsetmacro{\jO}{3}
\pgfmathsetmacro{\ig}{13}
\pgfmathsetmacro{\igg}{16}
\pgfmathsetmacro{\jgg}{2}
\pgfmathsetmacro{\width}{12}
\pgfmathsetmacro{\height}{2}
\pgfmathsetmacro{\wspace}{1}
\pgfmathsetmacro{\K}{8}
\pgfmathsetmacro{\L}{7}
\pgfmathsetmacro{\W}{3}
\pgfmathtruncatemacro{\k}{\K-1}
\pgfmathtruncatemacro{\w}{\L-1}
\pgfmathtruncatemacro{\ww}{\L-2}
\pgfmathsetmacro{\Lm}{50}

\node[] (origin) {};


%\visible<2>{
%    \fill[green!20] ($ (origin.center) + (\iO*\width /\Lm/2 - \w/2*\width /\Lm/2, 0)$)
%    -- ++(0, -\height)
%    -- ++(\L*\width/2/\Lm, 0)
%    -- ++(0, \height)
%    -- cycle;
%    \draw[<->, dashed] ($ (origin.center) + (\iO*\width /\Lm/2 - \w/2*\width /\Lm/2, -\height/2.1)$)
%    -- ++(\L*\width/2/\Lm, 0) node[midway, below, above, thick] {\hskip.5em$2L-1$ };
%    \fill[blue!50] ($ (origin.center) + (\iO*\width /\Lm/2, -\jO*\height /\K)$)
%    -- ++(0, -\height/\K)
%    -- ++(\width/2/\Lm, 0)
%    -- ++(0, \height/\K)
%    -- cycle;
%}
%\only<3->{
%    \fill[red!20] ($ (origin.center) + (\ig*\width /\Lm/2 - \w/2*\width /\Lm/2, 0)$)
%    -- ++(0, -\height)
%    -- ++(\L*\width/2/\Lm, 0)
%    -- ++(0, \height)
%    -- cycle;
%    
%    \fill[blue!50] ($ (origin.center) + (\ig*\width /\Lm/2, -\jO*\height /\K)$)
%    -- ++(0, -\height/\K)
%    -- ++(\width/2/\Lm, 0)
%    -- ++(0, \height/\K)
%    -- cycle;
%    
%}
%
%\only<4>{
%    
%    \fill[red!20] ($ (origin.center) + (\igg*\width /\Lm/2 - \w/2*\width /\Lm/2, 0)$)
%    -- ++(0, -\height)
%    -- ++(\L*\width/2/\Lm, 0)
%    -- ++(0, \height)
%    -- cycle;
%    \fill[gray!40] ($ (origin.center) + (\igg*\width /\Lm/2 - \w/2*\width /\Lm/2, 0)$)
%    -- ++(0, -\height)
%    -- ++(\w/2*\width /\Lm/2, 0)
%    -- ++(\width /\Lm/2, 0)
%    -- ++(0, \height)
%    -- cycle;
%    \fill[blue!50] ($ (origin.center) + (\igg*\width /\Lm/2, -\jgg*\height /\K)$)
%    -- ++(0, -\height/\K)
%    -- ++(\width/2/\Lm, 0)
%    -- ++(0, \height/\K)
%    -- cycle;
%    \fill[blue!50] ($ (origin.center) + (\ig*\width /\Lm/2, -\jO*\height /\K)$)
%    -- ++(0, -\height/\K)
%    -- ++(\width/2/\Lm, 0)
%    -- ++(0, \height/\K)
%    -- cycle;
%}


\only<1>{
    \node (southwest) at ($(origin.center) - (\width / 2, \height / 2)$) {};
    \node (northeast) at ($(origin.center) + (\width / 2, \height / 2)$) {};
    
    \foreach \i in {1,...,\k}{
        \draw[black!50, thick] ($(southwest.center) + (0, \i*\height /\K)$)
        -- ++(\width, 0);
    }
    
    
    \foreach \i in {1,...,\Lm}{
        \draw[black!50, thick] ($ (southwest.center) + (\i*\width / \Lm, 0)$)
        -- ++(0, \height);
    }
    \draw[draw=black, ultra thick] (southwest.center)
                         rectangle (northeast.center)
                         node[midway, fill=lightblue!70, rounded corners=5pt] {\Large Activation};
    
    \draw[draw=black, thick, <->] (southwest.south) -- ++(\width, 0) node[midway, below] {T};
    \draw[draw=black, thick, <->] (southwest.west) -- ++(0, \height) node[midway, left] {K};
}

\only<2->{
    \foreach \w in {1,...,\W}{
        
        \node (southwest\w) at ($(origin.center) - (\width / 2 - 1.3*\w*\width / \W + 1.3*\width / \W, \height / 2)$) {};
        \node (northeast\w) at ($(southwest\w.center) + (\width / \W, \height)$) {};
        
        \foreach \i in {1,...,\k}{
            \draw[black!50, thick] ($(southwest\w.center) + (0, \i*\height /\K)$)
            -- ++(\width / \W, 0);
        }
        
        
        \foreach \i in {1,...,\Lm/\W}{
            \draw[black!50, thick] ($ (southwest\w.center) + (\i*\width / \Lm, 0)$)
            -- ++(0, \height);
        }
    \draw[draw=black, ultra thick] (southwest\w.center)
                         rectangle (northeast\w.center)
          node[midway, fill=lightblue!70, rounded corners=5pt] {$\mathcal W_\w$};
    }

    \draw[draw=black, thick, <->] (southwest1.south) -- ++(\width/\W, 0) node[midway, below] {T};
    \draw[draw=black, thick, <->] (southwest1.west) -- ++(0, \height) node[midway, left] {K};
    
}
\only<3>{
    \foreach \w in {1,...,\W-1}{
        \node (eastw) at ($(origin.center) - (\width / 2 - 1.3*\w*\width / \W + .3*\width / \W ,
                                                   0)$) {};
        \draw[<->, shorten >= 5pt, shorten <=5pt, thick] (eastw.center) -- ++(.3*\width / \W, 0);
    }
}

%\draw (origin.center)
%-- ++(\width/2, 0)
%-- ++(0, -\height)
%-- ++(-\width/2, 0) node[midway, below] {coordinates of $Z$}
%-- cycle;


% Draw the worker boundaries
%\draw [ultra thick] (origin.center) 
%-- ++(0, -\height);
%\foreach \i in {1,...,\W}{
%    \draw [ultra thick] ($ (origin.center) + (\i*\width/2/\W, 0)$)
%    -- ++(0, -\height);
%    \draw [ultra thick] ($ (origin.center) + (\i*\width/2/\W, 0)$)
%    -- ++(-\width/2/\W, 0) node[midway, above] {$\mathcal S_{\i}$};
%    \draw [ultra thick] ($ (origin.center) + (\i*\width/2/\W, -\height)$)
%    -- ++(-\width/2/\W, 0);
%}

%\only<3>{
%
%\draw[->, thick] ($ (origin.center) + (\ig*\width /\Lm/2, -\jO*\height /\K) + (\width/\Lm/4, -\height /\K/2)$) arc (135:45:1.1) node [midway, above, fill=blue!10] {$(k, t, \Delta Z)$};
%}
\end{tikzpicture}


\end{document}
