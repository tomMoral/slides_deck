\documentclass[main_tikz.tex]{subfiles}
%\usetikzlibrary{...}


%\usepackage{beamerarticle}
\begin{document}

\begin{tikzpicture}

\tikzset{
    %Define standard arrow tip
   >=stealth',
    %Define style for boxes
    bold/.style={
           draw=black,
           ultra thick,
          % shorten <=2pt,
           %shorten >=2pt,}
    },
    arrow/.style={
        draw=black,
        thick,
        % shorten <=2pt,
        shorten >=3pt,
    },
    overlay/.style={
        draw=black!50,
        thick,
        fill=lightblue!70,
        rounded corners=5pt
    },
}

\pgfmathsetmacro{\width}{12}
\pgfmathsetmacro{\height}{2}
\pgfmathsetmacro{\wspace}{1}
\pgfmathsetmacro{\K}{8}
\pgfmathsetmacro{\L}{7}
\pgfmathsetmacro{\W}{3}
\pgfmathtruncatemacro{\k}{\K-1}
\pgfmathsetmacro{\Lm}{51}

\coordinate (origin);


%\visible<2>{
%    \fill[green!20] ($ (origin.center) + (\iO*\width /\Lm/2 - \w/2*\width /\Lm/2, 0)$)
%    -- ++(0, -\height)
%    -- ++(\L*\width/2/\Lm, 0)
%    -- ++(0, \height)
%    -- cycle;
%    \draw[<->, dashed] ($ (origin.center) + (\iO*\width /\Lm/2 - \w/2*\width /\Lm/2, -\height/2.1)$)
%    -- ++(\L*\width/2/\Lm, 0) node[midway, below, above, thick] {\hskip.5em$2L-1$ };
%    \fill[blue!50] ($ (origin.center) + (\iO*\width /\Lm/2, -\jO*\height /\K)$)
%    -- ++(0, -\height/\K)
%    -- ++(\width/2/\Lm, 0)
%    -- ++(0, \height/\K)
%    -- cycle;
%}
%\only<3->{
%    \fill[red!20] ($ (origin.center) + (\ig*\width /\Lm/2 - \w/2*\width /\Lm/2, 0)$)
%    -- ++(0, -\height)
%    -- ++(\L*\width/2/\Lm, 0)
%    -- ++(0, \height)
%    -- cycle;
%    
%    \fill[blue!50] ($ (origin.center) + (\ig*\width /\Lm/2, -\jO*\height /\K)$)
%    -- ++(0, -\height/\K)
%    -- ++(\width/2/\Lm, 0)
%    -- ++(0, \height/\K)
%    -- cycle;
%    
%}
%
%\only<4>{
%    
%    \fill[red!20] ($ (origin.center) + (\igg*\width /\Lm/2 - \w/2*\width /\Lm/2, 0)$)
%    -- ++(0, -\height)
%    -- ++(\L*\width/2/\Lm, 0)
%    -- ++(0, \height)
%    -- cycle;
%    \fill[gray!40] ($ (origin.center) + (\igg*\width /\Lm/2 - \w/2*\width /\Lm/2, 0)$)
%    -- ++(0, -\height)
%    -- ++(\w/2*\width /\Lm/2, 0)
%    -- ++(\width /\Lm/2, 0)
%    -- ++(0, \height)
%    -- cycle;
%    \fill[blue!50] ($ (origin.center) + (\igg*\width /\Lm/2, -\jgg*\height /\K)$)
%    -- ++(0, -\height/\K)
%    -- ++(\width/2/\Lm, 0)
%    -- ++(0, \height/\K)
%    -- cycle;
%    \fill[blue!50] ($ (origin.center) + (\ig*\width /\Lm/2, -\jO*\height /\K)$)
%    -- ++(0, -\height/\K)
%    -- ++(\width/2/\Lm, 0)
%    -- ++(0, \height/\K)
%    -- cycle;
%}


\only<2>{
    \node (southwest) at ($(origin) - (\width / 2, \height / 2)$) {};
    \node (northeast) at ($(origin) + (\width / 2, \height / 2)$) {};
    
    \foreach \i in {1,...,\k}{
        \draw[black!50, thick] ($(southwest.center) + (0, \i*\height /\K)$)
        -- ++(\width, 0);
    }
    
    
    \foreach \i in {1,...,\Lm}{
        \draw[black!50, thick] ($ (southwest.center) + (\i*\width / \Lm, 0)$)
        -- ++(0, \height);
    }
    \draw[bold] (southwest.center)
                         rectangle (northeast.center)
                         node[midway, overlay] {\Large Activation $Z$};
    
    \draw[draw=black, thick, <->] (southwest.south) -- ++(\width, 0) node[midway, below] {Temps};
    \draw[draw=black, thick, <->] (southwest.west) -- ++(0, \height) node[midway, above, sloped] {Atomes};
}

\only<2->{
    
    \pgfmathsetmacro{\widthWorker}{\width/\W}
    \coordinate (origin_worker) at ($(origin) + (0, 1.6*\height)$);
    \foreach \w in {1,...,\W}{
        
        \node (southwest\w) at ($(origin_worker) - (1.3*\width / 2 - 1.3*\w*\widthWorker + 1.15*\widthWorker, \height / 2)$) {};
        \node (northeast\w) at ($(southwest\w.center) + (\width / \W, \height)$) {};
        
        \foreach \i in {1,...,\k}{
            \draw[black!50, thick] ($(southwest\w.center) + (0, \i*\height /\K)$)
            -- ++(\width / \W, 0);
        }
        
        
        \foreach \i in {1,...,\Lm/\W}{
            \draw[black!50, thick] ($ (southwest\w.center) + (\i*\width / \Lm, 0)$)
            -- ++(0, \height);
        }
    \draw[bold] (southwest\w.center)
                         rectangle (northeast\w.center)
          node[midway, overlay] {$\mathcal W_\w$};
          
          
    % Draw the splitting of the signal
    \only<2>{
        \draw[bold, dashed] ($(southwest.center) + (\w*\widthWorker, 0)$)
                -- ++(0, \height);
              rectangle (northeast\w.center)
       \draw[arrow, ->] ($(southwest.center) + (\w*\widthWorker - \widthWorker / 2, \height)$)
                -- ($(southwest\w) + (\widthWorker/2, 0)$);
    
        \draw[draw=black, thick, <->] (northeast1.north)
            -- ++(-\width/\W, 0) node[midway, above] {Temps / Noeuds};
        \draw[draw=black, thick, <->] (southwest1.west)
            -- ++(0, \height) node[midway, above, sloped] {Atomes};
    }
        
    }
    
}
\only<3>{
    \foreach \w in {1,...,\W-1}{
        \coordinate (eastw) at
            ($(origin_worker) - (1.3*\width / 2 - 1.3*\w*\widthWorker + .15*\widthWorker, 0)$);
        \draw[<->, shorten >= 5pt, shorten <=5pt, thick] (eastw.center) -- ++(.3*\width / \W, 0);
    }
}

%\draw (origin.center)
%-- ++(\width/2, 0)
%-- ++(0, -\height)
%-- ++(-\width/2, 0) node[midway, below] {coordinates of $Z$}
%-- cycle;


% Draw the worker boundaries
%\draw [ultra thick] (origin.center) 
%-- ++(0, -\height);
%\foreach \i in {1,...,\W}{
%    \draw [ultra thick] ($ (origin.center) + (\i*\width/2/\W, 0)$)
%    -- ++(0, -\height);
%    \draw [ultra thick] ($ (origin.center) + (\i*\width/2/\W, 0)$)
%    -- ++(-\width/2/\W, 0) node[midway, above] {$\mathcal S_{\i}$};
%    \draw [ultra thick] ($ (origin.center) + (\i*\width/2/\W, -\height)$)
%    -- ++(-\width/2/\W, 0);
%}

%\only<3>{
%
%\draw[->, thick] ($ (origin.center) + (\ig*\width /\Lm/2, -\jO*\height /\K) + (\width/\Lm/4, -\height /\K/2)$) arc (135:45:1.1) node [midway, above, fill=blue!10] {$(k, t, \Delta Z)$};
%}
\end{tikzpicture}


\end{document}
